var X=Object.defineProperty;var Y=(l,s,t)=>s in l?X(l,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[s]=t;var d=(l,s,t)=>Y(l,typeof s!="symbol"?s+"":s,t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&a(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function D(l){return Math.ceil(100/l)}class K{constructor(s){d(this,"root");d(this,"energy",100);d(this,"lives",3);d(this,"points",0);d(this,"canvasElem");if(!s)throw new Error("Root element not found");this.root=s,this.canvasElem=document.createElement("canvas"),this.initGame()}reloadGame(){this.energy=100,this.lives=3,this.points=0,this.initGame()}renderEndGame(){this.root.innerHTML="",this.root.innerHTML=`
      <div>
      <h1>Game Over</h1>
      <div>
        Ваш счет: ${this.points}
      </div>
      <button class="reload-button">Начать заново</button>
      </div>
    `;const s=this.root.querySelector(".reload-button");s&&s.addEventListener("click",()=>{this.reloadGame()})}initGame(){console.log("INITIALIZE GAME"),this.root.innerHTML="",this.canvasElem.innerHTML="",this.root.appendChild(this.canvasElem);const s=this.canvasElem,t=s.getContext("2d");s.width=800,s.height=600;const a=[],i={x:s.width/2,y:s.height-70,speed:5,bullets:[]};function o(e,n,c){for(let f=0;f<20;f++)a.push({x:e,y:n,size:Math.random()*5+2,speedX:(Math.random()-.5)*4,speedY:(Math.random()-.5)*4,color:c,life:Math.random()*30+30})}const u=()=>{t.fillStyle="red",t.fillRect(10,s.height-20,200,10),t.fillStyle="green",t.fillRect(10,s.height-20,this.energy/100*200,10),t.fillStyle="white",t.font="20px Arial",t.fillText(`Lives: ${this.lives}`,s.width-100,30),t.fillStyle="white",t.font="20px Arial",t.fillText(`Score: ${this.points}`,10,30)};function L(){a.forEach(e=>{t.beginPath(),t.arc(e.x,e.y,e.size,0,Math.PI*2),t.fillStyle=e.color,t.fill()})}function A(){a.forEach((e,n)=>{e.x+=e.speedX,e.y+=e.speedY,e.size*=.95,e.life-=1,(e.life<=0||e.size<=.5)&&a.splice(n,1)})}const m=[[0,0,0,0,0,0,1,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,0,0,0,0,0],[0,0,0,3,0,1,2,1,0,3,0,0,0],[0,0,0,1,1,1,2,1,1,1,0,0,0],[0,0,1,1,1,1,1,1,1,1,1,0,0],[1,1,1,1,1,1,1,1,1,1,1,1,1],[0,0,4,3,4,0,0,0,4,3,4,0,0],[0,0,4,3,4,0,0,0,4,3,4,0,0],[0,0,0,4,0,0,0,0,0,4,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0]],y=7,w=Array.from({length:100},()=>({x:Math.random()*s.width,y:Math.random()*s.height,speed:1})),r=[],P=7,z=2;let x=!0;function I(){t.fillStyle="black",t.fillRect(0,0,s.width,s.height),t.fillStyle="white",w.forEach(e=>{t.beginPath(),t.fillRect(e.x,e.y,2,2),t.fill()})}function G(){w.forEach(e=>{e.y+=e.speed,e.y>s.height&&(e.y=0,e.x=Math.random()*s.width)})}const v=[];function R(e,n,c){v.push({x:e,y:n,score:c,opacity:1,duration:120})}const E=new Image;E.src="/cartoonship.png";const T=()=>{t.drawImage(E,i.x,i.y,70,70)};function O(){t.fillStyle="red",i.bullets.forEach(e=>{t.fillRect(e.x,e.y,4,10)})}function k(){r.forEach(e=>{t.save(),t.translate(e.x,e.y),t.beginPath();const n=Math.floor(Math.random()*5)+5,c=Math.PI*2/n;for(let h=0;h<n;h++){const f=h*c,p=e.size,b=Math.cos(f)*p,S=Math.sin(f)*p;h===0?t.moveTo(b,S):t.lineTo(b,S)}t.closePath(),t.fillStyle="gray",t.fill(),t.strokeStyle="black",t.lineWidth=1,t.stroke(),t.restore()})}function H(){g.ArrowLeft&&i.x>0&&(i.x-=i.speed),g.ArrowRight&&i.x<s.width-10*y&&(i.x+=i.speed)}function q(){i.bullets=i.bullets.filter(e=>e.y>0),i.bullets.forEach(e=>e.y-=P)}const F=()=>{r.forEach(e=>{e.y+=e.speed,e.y>s.height&&(r.splice(r.indexOf(e),1),this.energy-=20,this.energy<=0&&(x=!1))})};function N(){const e=Math.random()*20+10,n=Math.random()*(s.width-e*2)+e;r.push({x:n,y:-e,size:e,speed:Math.random()*1.5+z})}const $=()=>{r.forEach((e,n)=>{i.bullets.forEach((c,h)=>{if(Math.hypot(e.x-c.x,e.y-c.y)<e.size){console.log(e.size),o(e.x,e.y,"white");const p=D(e.size);this.points+=p,R(e.x,e.y,p),r.splice(n,1),i.bullets.splice(h,1),this.energy=Math.min(this.energy+7,100)}})}),r.forEach((e,n)=>{Math.hypot(e.x-(i.x+m[0].length*y/2),e.y-i.y)<e.size+m.length*y/6&&(o(e.x,e.y,"orange"),r.splice(n,1),this.lives--,this.lives<=0&&(x=!1))})};function B(){v.forEach((e,n)=>{t.save(),t.globalAlpha=e.opacity,t.fillStyle="#09e814",t.font="20px Arial",t.fillText(`+${e.score}`,e.x,e.y),e.y-=1,e.opacity-=1/e.duration,e.opacity<=0&&v.splice(n,1),t.restore()})}function C(){i.bullets.push({x:i.x+m[0].length/1.9*y-2,y:i.y}),i.bullets.push({x:i.x+m[0].length/3.9*y-2,y:i.y})}const g={};document.addEventListener("keydown",e=>{g[e.key]=!0,e.key===" "&&C()}),document.addEventListener("keyup",e=>g[e.key]=!1);const M=()=>{if(!x){this.renderEndGame();return}t.clearRect(0,0,s.width,s.height),I(),u(),G(),T(),O(),k(),L(),B(),H(),q(),F(),A(),$(),requestAnimationFrame(M)};setInterval(N,1500),M()}}const U=document.querySelector("#app");new K(U);
